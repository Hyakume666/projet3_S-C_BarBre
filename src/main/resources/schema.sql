-- Suppression des tables existantes (dans l'ordre des dépendances)
-- DROP TABLE METEO CASCADE CONSTRAINTS;
-- DROP TABLE STATIONMETEO CASCADE CONSTRAINTS;
-- DROP TABLE PAYS CASCADE CONSTRAINTS;

-- Table PAYS
-- Stocke les informations des pays
CREATE TABLE PAYS (
    NUMERO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CODE VARCHAR2(5) NOT NULL UNIQUE,
    NOM VARCHAR2(100) NOT NULL
);

COMMENT ON TABLE PAYS IS 'Table des pays';
COMMENT ON COLUMN PAYS.NUMERO IS 'Identifiant unique du pays (auto-généré)';
COMMENT ON COLUMN PAYS.CODE IS 'Code ISO du pays (ex: CH, FR, DE)';
COMMENT ON COLUMN PAYS.NOM IS 'Nom complet du pays';

-- Table STATIONMETEO
-- Stocke les stations météorologiques
CREATE TABLE STATIONMETEO (
    NUMERO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    LATITUDE NUMBER(10, 6) NOT NULL,
    LONGITUDE NUMBER(10, 6) NOT NULL,
    NOM VARCHAR2(200) NOT NULL,
    NUM_PAYS NUMBER,
    OPENWEATHERMAPID NUMBER NOT NULL UNIQUE,
    CONSTRAINT FK_STATION_PAYS FOREIGN KEY (NUM_PAYS) REFERENCES PAYS(NUMERO)
);

COMMENT ON TABLE STATIONMETEO IS 'Table des stations météorologiques';
COMMENT ON COLUMN STATIONMETEO.NUMERO IS 'Identifiant unique de la station (auto-généré)';
COMMENT ON COLUMN STATIONMETEO.LATITUDE IS 'Latitude GPS de la station';
COMMENT ON COLUMN STATIONMETEO.LONGITUDE IS 'Longitude GPS de la station';
COMMENT ON COLUMN STATIONMETEO.NOM IS 'Nom de la ville/localité';
COMMENT ON COLUMN STATIONMETEO.NUM_PAYS IS 'Référence vers le pays';
COMMENT ON COLUMN STATIONMETEO.OPENWEATHERMAPID IS 'Identifiant unique OpenWeatherMap';

-- Index pour améliorer les performances
CREATE INDEX IDX_STATION_PAYS ON STATIONMETEO(NUM_PAYS);
CREATE INDEX IDX_STATION_OWM ON STATIONMETEO(OPENWEATHERMAPID);

-- Table METEO
-- Stocke les mesures météorologiques
CREATE TABLE METEO (
    NUMERO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DATEMESURE DATE NOT NULL,
    TEMPERATURE NUMBER(5, 2) NOT NULL,
    DESCRIPTION VARCHAR2(200),
    PRESSION NUMBER(6, 2),
    HUMIDITE NUMBER(5, 2),
    VISIBILITE NUMBER(10),
    PRECIPITATION NUMBER(6, 2),
    NUM_STATIONMETEO NUMBER NOT NULL,
    CONSTRAINT FK_METEO_STATION FOREIGN KEY (NUM_STATIONMETEO) REFERENCES STATIONMETEO(NUMERO) ON DELETE CASCADE
);

COMMENT ON TABLE METEO IS 'Table des mesures météorologiques';
COMMENT ON COLUMN METEO.NUMERO IS 'Identifiant unique de la mesure (auto-généré)';
COMMENT ON COLUMN METEO.DATEMESURE IS 'Date et heure de la mesure';
COMMENT ON COLUMN METEO.TEMPERATURE IS 'Température en degrés Celsius';
COMMENT ON COLUMN METEO.DESCRIPTION IS 'Description textuelle du temps (ex: nuageux, ensoleillé)';
COMMENT ON COLUMN METEO.PRESSION IS 'Pression atmosphérique en hPa';
COMMENT ON COLUMN METEO.HUMIDITE IS 'Humidité relative en pourcentage';
COMMENT ON COLUMN METEO.VISIBILITE IS 'Visibilité en mètres';
COMMENT ON COLUMN METEO.PRECIPITATION IS 'Précipitations en mm';
COMMENT ON COLUMN METEO.NUM_STATIONMETEO IS 'Référence vers la station';

-- Index pour améliorer les performances
CREATE INDEX IDX_METEO_STATION ON METEO(NUM_STATIONMETEO);
CREATE INDEX IDX_METEO_DATE ON METEO(DATEMESURE);

-- Contrainte d'unicité pour éviter les doublons de mesures
CREATE UNIQUE INDEX IDX_METEO_UNIQUE ON METEO(NUM_STATIONMETEO, DATEMESURE);

-- Vérification de la création
SELECT table_name FROM user_tables WHERE table_name IN ('PAYS', 'STATIONMETEO', 'METEO');

COMMIT;
